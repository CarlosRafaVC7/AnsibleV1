# PAM Access Control Configuration
# Generated by Ansible Security Framework
# Date: {{ ansible_date_time.date }}
# 
# Format: permission:users:origins
# permission: + (allow) or - (deny)
# users: usernames or groups (group names prefixed with @)
# origins: terminals, hosts, or networks

# Allow root access from all terminals
+ : root : ALL

# Allow admin groups access from all terminals
+ : @academic_admin : ALL
+ : @admin : ALL

# Students access restrictions - only during allowed hours and from console
{% if 'students' in groups %}
+ : @students : LOCAL
+ : @students : console
+ : @students : tty1 tty2 tty3 tty4 tty5 tty6
{% endif %}

# Practice users - limited access
{% if 'practice' in groups %}
+ : @practice : LOCAL
+ : @practice : console
+ : @practice : tty1 tty2 tty3
{% endif %}

# Gamer groups access (if applicable)
{% if 'gamer' in groups %}
+ : @gamer : LOCAL
+ : @gamer : console
{% endif %}

# Lab developers access
{% if 'lab_developers' in groups %}
+ : @lab_developers : ALL
{% endif %}

# SSH access control
{% if ansible_os_family == "Debian" or ansible_os_family == "RedHat" %}
# Allow SSH access for admin groups
+ : @academic_admin : ALL
+ : @admin : ALL

# Restrict SSH for students to specific networks
{% if security_ssh_allowed_networks is defined %}
{% for network in security_ssh_allowed_networks %}
+ : @students : {{ network }}
+ : @practice : {{ network }}
{% endfor %}
{% else %}
# Default: allow from local network only
+ : @students : 192.168.0.0/16
+ : @students : 10.0.0.0/8
+ : @practice : 192.168.0.0/16
+ : @practice : 10.0.0.0/8
{% endif %}
{% endif %}

# Deny all other access by default
- : ALL : ALL